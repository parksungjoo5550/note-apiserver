<html>
    <head>
        <meta charset="utf-8"/>
        
        <% include ../head %>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
        
        <style>
            .list-group{
                display:inline-block;
                width:20%;
                padding: 5px;
            }

        </style>
    </head>
    <body>
    <div class="container-fluid">
        <div class="row">
            <h1>
                카테고리 조회
            </h1>
        </div> <br>
        
        <div class="row alert-message block-message error">
            <ul id="error-ul">
                <% if (locals.message) { %><li style="color: red"><%= message %></li><% } %>
            </ul>
        </div>
        
        <div class="row">
        <div class="list-group" >
            <span id="bigChapter-list">
            <% if ( locals.bigChapterList ) { %>
                <% for (let i = 0; i < bigChapterList.length; i++ ) { %>
                    <button type="button" class="list-group-item list-group-item-action"><%= bigChapterList[i] %></button>
                <% } %>
            <% } %>
            </span>
            <form method="POST" action="/front/problem/inquiry/">
                <input type="text" class="form-control mt-1" placeholder="카테고리 추가" name="bigChapter">
            </form>
        </div>
        
        <div class="list-group">
            <span id="middleChapter-list">
            </span>
            <form method="POST" action="/front/problem/inquiry/">
                <input type="text" class="form-control mt-1" placeholder="카테고리 추가" name="bigChapter">
            </form>
        </div>
        
        <div class="list-group" id="smallChapter-list">
            <form method="POST" action="/front/problem/inquiry/">
                
            </form>
        </div>
        </div>
        <br>
        <a href="/front"> 메인 페이지 </a>
    </div>

	<script>
        function msgError(msg){
            $('#error-ul').html('<li style="color: red">' + msg + '</li>');
        }
        
        function generateButton(text) {
            return $('<button type="button" class="list-group-item list-group-item-action">' + text + '</button>');
        }
        
        $('#bigChapter-list button').on('click', function (e) {
            e.preventDefault()

            $.ajax({
                type: "POST",
                url: '/api/category/list',
                headers: {
                    "x-access-token": $.cookie('token')
                },
                data: { bigChapter: $(this).html() },
                success: function (data){
                    if (data.success == false) {
                        msgError(data.message);
                        return;
                    }
                    
                    $('#middleChapter-list').html('');
                    data.data.categories.forEach( (category) => {
                        middleChapter = generateButton(category);
                        $('#middleChapter-list').append(middleChapter);    
                    });
                    
                    $('#middleChapter-form').html('<input type="text" class="form-control mt-1" placeholder="카테고리 추가" name="middleChapter">');
                },
                dataType: 'json'
            });

            //$(this).tab('show')
        })
	</script>
    </body>
</html>